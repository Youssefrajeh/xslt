<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XSLT Transformation Runner - Dynamic</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
      }
      .transformation {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: #f9f9f9;
      }
      .transformation h3 {
        color: #2c3e50;
        margin-top: 0;
      }
      .result {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        padding: 10px;
        border-radius: 3px;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
        color: #333;
        font-size: 12px;
        line-height: 1.4;
      }
      .error {
        color: #dc3545;
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        padding: 10px;
        border-radius: 3px;
      }
      .success {
        color: #155724;
        background: #d4edda;
        border: 1px solid #c3e6cb;
        padding: 10px;
        border-radius: 3px;
      }
      .file-input {
        margin: 20px 0;
        padding: 15px;
        background: #e3f2fd;
        border-radius: 5px;
      }
      .file-input input {
        margin: 10px 0;
      }
      .file-list {
        margin: 10px 0;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>XSLT Transformation Runner - Dynamic</h1>
      <p>
        This page will run XSLT transformations on the
        OrganizationalStructure.xml file. Select XSLT files from your folder to
        process them.
      </p>

      <div class="file-input">
        <h3>Select XSLT Files</h3>
        <input type="file" id="xsltFiles" multiple accept=".xslt,.xsl" />
        <div class="file-list" id="fileList"></div>
        <button onclick="runSelectedTransformations()">
          Run Transformations
        </button>
      </div>

      <div id="results"></div>
    </div>

    <script>
      // XML content
      const xmlContent = `<?xml version="1.0" encoding="utf-8"?>
<organization name="The ABC Toy Company">
  <associate name ="T. Baldwin" role="Chief Executive Officer">
    <manager-for>
      <associate name ="S. Talbot" role="Vice-President, Marketing">
        <manager-for>
          <associate name ="B. McAdams" role="Director, Customer Rewards Program">
            <manager-for>
              <associate name ="H. Zukarov" role="Team Leader, Rewards Management"/>
              <associate name ="N. Chen" role="Team Leader, Rewards Conversion"/>
            </manager-for>
          </associate>
        </manager-for>
      </associate>
      <associate name ="V. Singh" role="Vice-President, R &amp; D">
        <manager-for>
          <associate name ="B. Schwinn" role="Team Leader, Games R &amp; D"/>
          <associate name ="I. Bendavi" role="Team Leader, Toys R &amp; D"/>
        </manager-for>
      </associate>
      <associate name ="M. Chenney" role="Vice-President, Operations">
        <manager-for>
          <associate name ="L. Martinez" role="Team Leader, Games R &amp; D"/>
          <associate name ="N. Zui" role="Team Leader, Toys R &amp; D"/>
        </manager-for>
      </associate>
    </manager-for>
   </associate>
</organization>`;

      let selectedFiles = [];

      // Function to format XML with proper indentation
      function formatXML(xml) {
        let formatted = "";
        let indent = "";
        const tab = "  ";
        xml.split(/>\s*</).forEach(function (node) {
          if (node.match(/^\/\w/)) {
            // end tag
            indent = indent.substring(tab.length);
          }
          formatted += indent + "<" + node + ">\r\n";
          if (node.match(/^<?\w[^>]*[^\/]$/)) {
            // start tag
            indent += tab;
          }
        });
        return formatted.substring(1, formatted.length - 3);
      }

      function runTransformation(fileName, xsltContent) {
        const resultsDiv = document.getElementById("results");

        const transformationDiv = document.createElement("div");
        transformationDiv.className = "transformation";

        const title = document.createElement("h3");
        title.textContent = fileName;
        transformationDiv.appendChild(title);

        try {
          // Create XML and XSLT documents
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(xmlContent, "text/xml");
          const xsltDoc = parser.parseFromString(xsltContent, "text/xml");

          // Create XSLT processor
          const processor = new XSLTProcessor();
          processor.importStylesheet(xsltDoc);

          // Transform
          const result = processor.transformToFragment(xmlDoc, document);

          const resultDiv = document.createElement("div");
          resultDiv.className = "result";

          // Convert the result to a formatted XML string
          const serializer = new XMLSerializer();
          const xmlString = serializer.serializeToString(result);

          // Format the XML with proper indentation
          const formattedXml = formatXML(xmlString);
          resultDiv.textContent = formattedXml || "No XML content in result";

          transformationDiv.appendChild(resultDiv);

          const statusDiv = document.createElement("div");
          statusDiv.className = "success";
          statusDiv.textContent = "Transformation completed successfully";
          transformationDiv.appendChild(statusDiv);
        } catch (error) {
          const errorDiv = document.createElement("div");
          errorDiv.className = "error";
          errorDiv.textContent = "Error: " + error.message;
          transformationDiv.appendChild(errorDiv);
        }

        resultsDiv.appendChild(transformationDiv);
      }

      function runSelectedTransformations() {
        // Clear previous results
        document.getElementById("results").innerHTML = "";

        selectedFiles.forEach((file) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            runTransformation(file.name, e.target.result);
          };
          reader.readAsText(file);
        });
      }

      // Handle file selection
      document
        .getElementById("xsltFiles")
        .addEventListener("change", function (event) {
          selectedFiles = Array.from(event.target.files);

          const fileList = document.getElementById("fileList");
          fileList.innerHTML = "<strong>Selected files:</strong><br>";

          selectedFiles.forEach((file) => {
            fileList.innerHTML += `â€¢ ${file.name}<br>`;
          });
        });

      // Auto-load files from the current directory (if possible)
      window.onload = function () {
        // Try to automatically load XSLT files if they exist
        const autoLoadFiles = [
          "OrgStruct_3.1.1.xslt",
          "OrgStruct_3.1.2.xslt",
          "OrgStruct_4.1.1.xslt",
          "OrgStruct_4.1.2.xslt",
          "OrgStruct_5.1.1.xslt",
          "OrgStruct_5.1.2.xslt",
        ];

        // Note: Due to browser security restrictions, we can't automatically
        // read files from the local filesystem without user interaction.
        // The user needs to select the files manually.

        console.log("Please select XSLT files using the file input above.");
      };
    </script>
  </body>
</html>
